openapi: 3.0.1
info:
  title: Ielts platform System API
  version: "1.0"
  description: REST API for Ielts platform

tags:
  - name: Parent Api

servers:
  - url: http://localhost:8080

paths:
  /api/v1/auth/login:
    post:
      tags:
        - Parent Api
      summary: "User Login"
      description: "Authenticates the user by email and password. Returns access and refresh tokens on success."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: "Login successful"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                message: "Login successful"
                data:
                  accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                timestamp: "2025-06-10T00:12:33"
        '400':
          description: "Bad Request (Validation error)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: string
                        nullable: true
              example:
                success: false
                message: "Validation failure"
                data:
                  - "Email must not be blank"
                  - "Password must not be blank"
                timestamp: "2025-06-10T00:22:14"
        '401':
          description: "Unauthorized (Invalid credentials)"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                error: "Unauthorized"
                message: "Authentication required"
                data: null
                timestamp: "2025-06-10T00:02:22"
        '409':
          description: "Conflict (Account blocked or other business conflict)"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                error: "Conflict"
                message: "Account is blocked"
                data: null
                timestamp: "2025-06-10T00:02:22"
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: false
                error: "Internal server error"
                message: "Server error"
                data: null
                timestamp: "2025-06-09T23:55:22"

  /api/v1/auth/register-parent:
    post:
      tags:
        - Parent Api
      summary: "Register a new parent"
      description: "Register a new parent"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParentRegistrationRequest'
      responses:
        '200':
          description: "Parent registered successfully"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                message: "Parent registered successfully"
                data:
                  message: "Parent registered successfully"
                timestamp: "2025-06-10T00:25:12"
        '409':
          description: "Email already exists"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Email already exists"
                data: null
                timestamp: "2025-06-10T00:25:16"
        '400':
          description: "Bad Request (Validation error)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: string
                        nullable: true
              example:
                success: false
                message: "Validation failure"
                data:
                  - "firstName is required"
                  - "lastName is required"
                  - "email is required"
                  - "password is required"
                timestamp: "2025-06-10T00:22:14"
        '500':
          description: "Internal Server Error"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Failed to send activation email"
                data: null
                timestamp: "2025-06-10T00:25:25"

  /api/v1/auth/parent-activate:
    get:
      tags:
        - Parent Api
      summary: "Activate parent account by token"
      parameters:
        - in: query
          name: token
          schema:
            type: string
          required: true
          description: "Activation token sent to parent's email"
      responses:
        '200':
          description: "Parent activated successfully"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                message: "Parent activated successfully"
                data:
                  message: "Parent activated successfully"
                timestamp: "2025-06-10T00:27:30"
        '409':
          description: "Invalid or expired token"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              examples:
                invalidToken:
                  summary: "Token is invalid"
                  value:
                    success: false
                    message: "Invalid token"
                    data: null
                    timestamp: "2025-06-10T00:27:32"
                tokenExpired:
                  summary: "Token expired"
                  value:
                    success: false
                    message: "Token expired"
                    data: null
                    timestamp: "2025-06-10T00:27:36"
        '400':
          description: "Bad Request (Validation error)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: string
                        nullable: true
              example:
                success: false
                message: "Validation failure"
                data:
                  - "Token must not be blank"
                timestamp: "2025-06-10T00:22:14"
        '500':
          description: "Internal Server Error"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Unexpected error"
                data: null
                timestamp: "2025-06-10T00:27:42"

  /api/v1/parents/children/invite:
    post:
      tags:
        - Parent Api
      summary: "Invite a child (parent invites their child by email)"
      description: "Invite a child (parent invites their child by email)"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                childEmail:
                  type: string
                  format: email
                  description: "Child's email address"
              required:
                - childEmail
      responses:
        '200':
          description: "Invitation sent to child"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                message: "Invitation sent to child"
                data:
                  message: "Invitation sent to child"
                timestamp: "2025-06-10T00:40:00"
        '401':
          description: "Unauthorized (not authenticated or invalid token)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Authentication required"
                data: null
                timestamp: "2025-06-10T00:44:40"
        '404':
          description: "Parent or child not found"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              examples:
                parentNotFound:
                  summary: "Parent not found"
                  value:
                    success: false
                    message: "Parent user not found"
                    data: null
                    timestamp: "2025-06-10T00:40:04"
                childNotFound:
                  summary: "Child not found"
                  value:
                    success: false
                    message: "Child user not found"
                    data: null
                    timestamp: "2025-06-10T00:40:07"
        '400':
          description: "Bad Request (Validation error)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: string
                        nullable: true
              example:
                success: false
                message: "Validation failure"
                data:
                  - "childEmail can not be blank"
                timestamp: "2025-06-10T00:22:14"
        '500':
          description: "Internal Server Error"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Unexpected error"
                data: null
                timestamp: "2025-06-10T00:40:16"

  /api/v1/parents/me/children:
    get:
      tags:
        - Parent Api
      summary: "Get the list of children (students) for the authenticated parent"
      description: "Get the list of children (students) for the authenticated parent"
      responses:
        '200':
          description: "List of students belonging to the parent"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                  success: true
                  message: Children found
                  data:
                    - id: 7
                      firstName: John
                      lastName: Smith
                      email: john.smith@gmail.com
                      createdAt: 2025-06-01T12:00:00
                      updatedAt: 2025-06-08T12:00:00
                    - id: 9
                      firstName: Alice
                      lastName: Doe
                      email: alice.doe@gmail.com
                      createdAt: 2025-06-02T15:30:00
                      updatedAt: 2025-06-09T10:00:00
                  timestamp: 2025-06-10T19:53:37.495238
        '401':
          description: "Unauthorized (not authenticated or invalid token)"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Authentication required"
                data: null
                timestamp: "2025-06-10T00:44:40"
        '403':
          description: "Parent role required"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Parent role required"
                data: null
                timestamp: "2025-06-10T00:44:40"
        '404':
          description: "Parent not found or parent profile does not exist"
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        nullable: true
              example:
                success: false
                message: "Parent not found or parent profile does not exist"
                data: null
                timestamp: "2025-06-10T00:44:40"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          description: User email
          example: johndoe@gmail.com
        password:
          type: string
          description: User password
          example: 123456
      required:
        - email
        - password

    ParentRegistrationRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
        - password
      properties:
        firstName:
          type: string
          description: Parent's first name
          example: Dilshod
        lastName:
          type: string
          description: Parent's last name
          example: Jo'rayev
        email:
          type: string
          format: email
          description: Parent's email address
          example: dilshod@gmail.com
        password:
          type: string
          description: Parent's password
          example: 1234567

    InviteChildRequest:
      type: object
      properties:
        childEmail:
          type: string
          format: email
          example: student@example.com
      required:
        - childEmail

    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation successful"
        data:
          nullable: true
          description: "Any response data"
        timestamp:
          type: string
          format: date-time
          example: "2025-06-10T00:11:22"

security:
  - BearerAuth: []
